name: upload-wheel

description: "Upload wheels to Pypi"
inputs:
  os:
    required: true
    description: "ubuntu-22.04 or macos-13"
  repo:
    required: false
    description: "pypi or testpypi"
    type: choice
    options:
      - "pypi"
      - "testpypi"
      - "fury"
    default: "pypi"
  pypi_token:
    required: true
    description: "release token for the repo"
  fury_token:
    required: true
    description: "release token for the fury repo"

runs:
  using: "composite"
  steps:
  - name: Install dependencies
    shell: bash
    run: |
      python -m pip install --upgrade pip
      pip install twine
  - name: Publish to PyPI
    working-directory: python
    shell: bash
    run: |
      if [ ${{ inputs.repo }} == "fury" ]; then
        # For some reason, they use the token as the username
        twine upload --repository-url https://pypi.fury.io/lancedb/ \
          --username ${{ inputs.fury_token }} \
          --password "" \
          target/wheels/pylance-*.whl
      else
        twine upload --repository ${{ inputs.repo }} \
          --username __token__ \
          --password ${{ inputs.pypi_token }} \
          target/wheels/pylance-*.whl
      fi
