name: run-tests

description: "Install lance wheel and run unit tests"
inputs:
  python-minor-version:
    required: true
    description: "9 10 11 12"
  skip-torch:
    required: false
    description: "Skip pytorch tests"
    default: "false"
runs:
  using: "composite"
  steps:
    - name: Install dependencies
      working-directory: python
      shell: bash
      run: |
        # Create a clean virtual environment
        uv venv --seed
        # Install the pre-built wheel with all extras
        # This will automatically pull in all dependencies
        uv pip install $(ls target/wheels/pylance-*.whl)[tests,ray]
    - name: Install torch
      working-directory: python
      shell: bash
      if: inputs.skip-torch == 'false'
      run: |
        # Install cpu only pytorch with proper index strategy
        uv pip install torch --index-url https://pypi.org/simple --extra-index-url https://download.pytorch.org/whl/cpu
    - name: Run python tests
      shell: bash
      working-directory: python
      run: |
        uv run --no-project pytest -vvv -s --durations=30 python/tests
